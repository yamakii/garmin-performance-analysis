# è¨ˆç”»: BALANCED Sample Report Reproduction

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: `balanced_sample_reproduction`
- **ä½œæˆæ—¥**: `2025-10-25`
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: è¨ˆç”»ä¸­
- **ç›®çš„**: 3ã¤ã®BALANCEDã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒãƒ¼ãƒˆï¼ˆBase/Interval/Thresholdï¼‰ã®å½¢å¼ã‚’å¯èƒ½ãªé™ã‚Šå¿ å®Ÿã«å†ç¾ã™ã‚‹

## è¦ä»¶å®šç¾©

### ç›®çš„
ç¾åœ¨ã®BALANCED Report V2ã‚·ã‚¹ãƒ†ãƒ ãŒã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒãƒ¼ãƒˆã¨ç•°ãªã‚‹å‡ºåŠ›ã‚’ç”Ÿæˆã—ã¦ã„ã‚‹ã€‚ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒãƒ¼ãƒˆã®å½¢å¼ãƒ»æ§‹é€ ãƒ»å†…å®¹ã‚’åˆ†æã—ã€training typeåˆ¥ã«é©åˆ‡ãªãƒ¬ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã§ã€ä¸€è²«æ€§ã®ã‚ã‚‹é«˜å“è³ªãªãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚’å®Ÿç¾ã™ã‚‹ã€‚

### è§£æ±ºã™ã‚‹å•é¡Œ
1. **æ§‹é€ ã®ä¸ä¸€è‡´**: ã‚»ã‚¯ã‚·ãƒ§ãƒ³é †åºã€ã‚µãƒ–ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã€è©³ç´°åº¦ã®ç›¸é•
2. **å†…å®¹ã®ä¸å‡ä¸€**: Training typeé–“ã§ã®æƒ…å ±éå¤š/éå°‘
3. **ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ç›¸é•**: è¡¨å½¢å¼/ç®‡æ¡æ›¸ã/è‡ªç”±è¨˜è¿°ã®ä½¿ã„åˆ†ã‘ãŒä¸çµ±ä¸€
4. **Training typeå¯¾å¿œä¸è¶³**: Base/Interval/Thresholdã§ç•°ãªã‚‹ã¹ãè¡¨ç¾ãŒçµ±ä¸€ã•ã‚Œã¦ã„ã‚‹

### ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
1. **ãƒ™ãƒ¼ã‚¹ãƒ©ãƒ³åˆ†æ**: Zone 2-3ä¸­å¿ƒã®ä¸­å¼·åº¦èµ°ã®é©åˆ‡ãªè©•ä¾¡ã¨æ”¹å–„ææ¡ˆ
2. **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«åˆ†æ**: Work/RecoveryåŒºé–“ã®æ˜ç¢ºãªåˆ†é›¢ã¨VO2 Maxæ´»ç”¨åº¦è©•ä¾¡
3. **é–¾å€¤ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°åˆ†æ**: é–¾å€¤ãƒšãƒ¼ã‚¹ç¶­æŒæ™‚é–“ã¨Zone 4æ¯”ç‡ã®é‡ç‚¹è©•ä¾¡
4. **è‡ªå‹•ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ**: Training typeæ¤œå‡ºã‹ã‚‰é©åˆ‡ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé¸æŠã¾ã§è‡ªå‹•åŒ–

## ã‚®ãƒ£ãƒƒãƒ—åˆ†æ

### åˆ†æå¯¾è±¡ã‚µãƒ³ãƒ—ãƒ«
1. **Base run**: `result/individual/2025/10/2025-10-08_20625808856_SAMPLE_BALANCED.md`
   - Training type: `aerobic_base`
   - è·é›¢: 5.43km
   - ç‰¹å¾´: Zone 3ä¸­å¿ƒã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚µãƒãƒªãƒ¼å……å®Ÿã€é¡ä¼¼ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆæ¯”è¼ƒ

2. **Interval**: `result/individual/2025/10/2025-10-15_interval_SAMPLE_BALANCED.md`
   - Training type: `interval_training`
   - è·é›¢: 10.6km (1kmÃ—5æœ¬)
   - ç‰¹å¾´: Work/Recoveryæ˜ç¤ºã€ç”Ÿç†å­¦çš„æŒ‡æ¨™ã‚µãƒãƒªãƒ¼ã€VO2 Maxæ´»ç”¨åº¦

3. **Threshold**: `result/individual/2025/10/2025-10-24_threshold_SAMPLE_BALANCED.md`
   - Training type: `lactate_threshold`
   - è·é›¢: 6.13km (ãƒ¡ã‚¤ãƒ³3.35km)
   - ç‰¹å¾´: ãƒ¡ã‚¤ãƒ³åŒºé–“é‡è¦–ã€Zone 4æ™‚é–“æ¯”ç‡ã€é–¾å€¤è¶…éåº¦

### ä¸»è¦ãªå·®ç•°

#### 1. æ§‹é€ ä¸Šã®å·®ç•°

**ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒãƒ¼ãƒˆå…±é€šæ§‹é€ :**
```
1. åŸºæœ¬æƒ…å ± (ç°¡æ½”ãªç®‡æ¡æ›¸ã)
2. ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚µãƒãƒªãƒ¼
   - ç”Ÿç†å­¦çš„æŒ‡æ¨™ã‚µãƒãƒªãƒ¼ (Tempo/Interval only)
   - é¡ä¼¼ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆã¨ã®æ¯”è¼ƒ
   - å‚è€ƒå€¤ (VO2 Max, é–¾å€¤ãƒšãƒ¼ã‚¹)
3. ç·åˆè©•ä¾¡
   - ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚¿ã‚¤ãƒ—
   - ç·åˆæ‰€è¦‹ (â˜…â˜…â˜…â˜…â˜† X.X/5.0)
   - ãƒšãƒ¼ã‚¹ãƒ»å¿ƒæ‹æ¨ç§» (Mermaidã‚°ãƒ©ãƒ• + åˆ†æ)
4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™
   - ã‚¹ãƒ—ãƒªãƒƒãƒˆæ¦‚è¦ (è¡¨å½¢å¼)
   - ãƒã‚¤ãƒ©ã‚¤ãƒˆ
   - è©³ç´°åˆ†æ (æŠ˜ã‚ŠãŸãŸã¿)
   - ãƒ•ã‚©ãƒ¼ãƒ åŠ¹ç‡ (ãƒšãƒ¼ã‚¹è£œæ­£è©•ä¾¡)
5. ç”Ÿç†å­¦çš„æŒ‡æ¨™ã¨ã®é–¢é€£ (Tempo/Interval only)
   - VO2 Maxæ´»ç”¨åº¦
   - é–¾å€¤è¶…éåº¦
6. ãƒ•ã‚§ãƒ¼ã‚ºè©•ä¾¡
   - ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ— (â˜…è©•ä¾¡ä»˜ã)
   - ãƒ¡ã‚¤ãƒ³/Work (â˜…è©•ä¾¡ä»˜ã)
   - Recovery (Interval only, â˜…è©•ä¾¡ä»˜ã)
   - ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ (â˜…è©•ä¾¡ä»˜ã)
7. ç’°å¢ƒè¦å› 
   - æ°—è±¡æ¡ä»¶ãƒ»ç’°å¢ƒã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ (â˜…è©•ä¾¡ä»˜ã)
8. ğŸ’¡ æ”¹å–„ãƒã‚¤ãƒ³ãƒˆ
   - å„ªå…ˆåº¦ãƒ»é‡è¦åº¦ä»˜ãæ§‹é€ åŒ–ææ¡ˆ
9. æŠ€è¡“çš„è©³ç´° (æŠ˜ã‚ŠãŸãŸã¿)
10. ğŸ“š ç”¨èªè§£èª¬ (æŠ˜ã‚ŠãŸãŸã¿)
```

**ç¾åœ¨ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå•é¡Œç‚¹:**
- âœ… åŸºæœ¬æ§‹é€ ã¯ä¸€è‡´
- âŒ ç”Ÿç†å­¦çš„æŒ‡æ¨™ã‚µãƒãƒªãƒ¼ã®é…ç½®ãƒ»å†…å®¹ãŒä¸çµ±ä¸€
- âŒ ç·åˆæ‰€è¦‹ã®â˜…è©•ä¾¡ãŒæ¬ è½
- âŒ ãƒ•ã‚§ãƒ¼ã‚ºè©•ä¾¡ã®â˜…è©•ä¾¡ãŒæ¬ è½
- âŒ æ”¹å–„ãƒã‚¤ãƒ³ãƒˆã®æ§‹é€ åŒ–ï¼ˆâ­é‡è¦åº¦è¡¨ç¤ºï¼‰ãŒä¸å®Œå…¨
- âŒ Mermaidã‚°ãƒ©ãƒ•ã®åˆ†ææ–‡ãŒæ¬ è½ï¼ˆInterval/Thresholdã§å¿…é ˆï¼‰

#### 2. Training Typeåˆ¥å†…å®¹å·®ç•°

**Base Run (aerobic_base):**
| è¦ç´  | ã‚µãƒ³ãƒ—ãƒ« | ç¾çŠ¶ | å·®ç•° |
|------|---------|------|------|
| ç”Ÿç†å­¦çš„ã‚µãƒãƒªãƒ¼ | ãªã— | ãªã— | âœ… ä¸€è‡´ |
| é¡ä¼¼æ¯”è¼ƒ | å…¨ä½“ãƒšãƒ¼ã‚¹æ¯”è¼ƒ | å…¨ä½“ãƒšãƒ¼ã‚¹æ¯”è¼ƒ | âœ… ä¸€è‡´ |
| ç·åˆæ‰€è¦‹ | â˜…4.2/5.0è¡¨ç¤º | æ¬ è½ | âŒ è¿½åŠ å¿…è¦ |
| ãƒšãƒ¼ã‚¹è£œæ­£è©•ä¾¡ | è©³ç´°ãªè¡¨å½¢å¼ | ç°¡æ˜“ç‰ˆ | âŒ æ”¹å–„å¿…è¦ |
| ãƒ•ã‚§ãƒ¼ã‚ºè©•ä¾¡ | 3æ®µéš(W/R/C) | 3æ®µéš | âœ… ä¸€è‡´ |
| æ”¹å–„ãƒã‚¤ãƒ³ãƒˆ | â­é‡è¦åº¦3æ®µéš | ç®‡æ¡æ›¸ãã®ã¿ | âŒ æ§‹é€ åŒ–å¿…è¦ |

**Interval (interval_training):**
| è¦ç´  | ã‚µãƒ³ãƒ—ãƒ« | ç¾çŠ¶ | å·®ç•° |
|------|---------|------|------|
| ç”Ÿç†å­¦çš„ã‚µãƒãƒªãƒ¼ | ã‚ã‚Šï¼ˆVO2 Maxåˆ©ç”¨ç‡ã€FTP%ï¼‰ | ãªã— | âŒ è¿½åŠ å¿…è¦ |
| é¡ä¼¼æ¯”è¼ƒ | WorkåŒºé–“ãƒšãƒ¼ã‚¹æ¯”è¼ƒ | å…¨ä½“ãƒšãƒ¼ã‚¹ | âŒ å¤‰æ›´å¿…è¦ |
| ç·åˆæ‰€è¦‹ | â˜…4.8/5.0è¡¨ç¤º | æ¬ è½ | âŒ è¿½åŠ å¿…è¦ |
| ã‚¹ãƒ—ãƒªãƒƒãƒˆè¡¨ | ã‚¿ã‚¤ãƒ—åˆ—ï¼ˆW-up/W1/R1ï¼‰ | ãªã— | âŒ è¿½åŠ å¿…è¦ |
| ã‚°ãƒ©ãƒ•åˆ†æ | Work/Recoveryæ¨ç§»åˆ†æ | ãªã— | âŒ è¿½åŠ å¿…è¦ |
| ãƒ•ã‚§ãƒ¼ã‚ºè©•ä¾¡ | 4æ®µéš(W/Work/Rec/C) | 3æ®µéš | âŒ å¤‰æ›´å¿…è¦ |
| æ”¹å–„ãƒã‚¤ãƒ³ãƒˆ | Recoveryãƒšãƒ¼ã‚¹ç®¡ç†å„ªå…ˆ | ä¸€èˆ¬çš„ææ¡ˆ | âŒ ç‰¹åŒ–å¿…è¦ |

**Threshold (lactate_threshold):**
| è¦ç´  | ã‚µãƒ³ãƒ—ãƒ« | ç¾çŠ¶ | å·®ç•° |
|------|---------|------|------|
| ç”Ÿç†å­¦çš„ã‚µãƒãƒªãƒ¼ | ã‚ã‚Šï¼ˆé–¾å€¤ãƒšãƒ¼ã‚¹ä¸€è‡´ç¢ºèªï¼‰ | ãªã— | âŒ è¿½åŠ å¿…è¦ |
| é¡ä¼¼æ¯”è¼ƒ | ãƒ¡ã‚¤ãƒ³åŒºé–“ãƒšãƒ¼ã‚¹æ¯”è¼ƒ | å…¨ä½“ãƒšãƒ¼ã‚¹ | âŒ å¤‰æ›´å¿…è¦ |
| ç·åˆæ‰€è¦‹ | â˜…4.3/5.0è¡¨ç¤º | æ¬ è½ | âŒ è¿½åŠ å¿…è¦ |
| è©•ä¾¡å¯¾è±¡æ˜ç¤º | "ãƒ¡ã‚¤ãƒ³åŒºé–“ã®ã¿è©•ä¾¡" | å…¨ä½“è©•ä¾¡ | âŒ æ˜ç¤ºå¿…è¦ |
| ãƒ•ã‚©ãƒ¼ãƒ è©•ä¾¡ | ãƒ¡ã‚¤ãƒ³åŒºé–“ã®ã¿ | å…¨ä½“çµ±è¨ˆ | âŒ å¤‰æ›´å¿…è¦ |
| ãƒ•ã‚§ãƒ¼ã‚ºè©•ä¾¡ | 3æ®µéš(W/Run/C) | 3æ®µéš(W/Main/Finish) | âš ï¸ å‘½åå¤‰æ›´ |
| æ”¹å–„ãƒã‚¤ãƒ³ãƒˆ | Zone 4æ™‚é–“å»¶é•·ææ¡ˆ | ä¸€èˆ¬çš„ææ¡ˆ | âŒ ç‰¹åŒ–å¿…è¦ |

#### 3. ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¸Šã®å·®ç•°

**ç·åˆæ‰€è¦‹ (ã‚µãƒ³ãƒ—ãƒ« vs ç¾çŠ¶):**
```
[ã‚µãƒ³ãƒ—ãƒ«]
### ç·åˆæ‰€è¦‹ (â˜…â˜…â˜…â˜…â˜† 4.2/5.0)

ä»Šæ—¥ã®ãƒ©ãƒ³ã¯è³ªã®é«˜ã„æœ‰é…¸ç´ ãƒ™ãƒ¼ã‚¹èµ°ã§ã—ãŸã€‚å¹³å‡å¿ƒæ‹æ•°146bpmã€
å¹³å‡ãƒšãƒ¼ã‚¹6:45/kmã€å¹³å‡ãƒ‘ãƒ¯ãƒ¼225Wã¨ã„ã†é©åˆ‡ãªä¸­å¼·åº¦ã§ã€
ãƒšãƒ¼ã‚¹å¤‰å‹•ä¿‚æ•°0.017ã¨éå¸¸ã«é«˜ã„å®‰å®šæ€§ã‚’ç™ºæ®ã—ã¦ã„ã¾ã™ã€‚

**âœ… å„ªã‚Œã¦ã„ã‚‹ç‚¹:**
- ãƒšãƒ¼ã‚¹å®‰å®šæ€§: å¤‰å‹•ä¿‚æ•°0.017ï¼ˆç›®æ¨™<0.05ã‚’å¤§å¹…ã‚¯ãƒªã‚¢ï¼‰
- **ãƒ‘ãƒ¯ãƒ¼åŠ¹ç‡å‘ä¸Š**: å‰å›æ¯”-5Wï¼ˆ2.2%åŠ¹ç‡ã‚¢ãƒƒãƒ—ï¼‰âœ…
- ãƒ•ã‚©ãƒ¼ãƒ åŠ¹ç‡: å…¨æŒ‡æ¨™ã§ãƒšãƒ¼ã‚¹è£œæ­£å¾Œã«å„ªç§€è©•ä¾¡

**âš ï¸ æ”¹å–„å¯èƒ½ãªç‚¹:**
- ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—ä¸è¶³: æœ€åˆã‹ã‚‰å¿ƒæ‹145bpmã§ã‚¹ã‚¿ãƒ¼ãƒˆ
- ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³æ¬ å¦‚: é‹å‹•å¾Œã®æ€¥æ¿€ãªè² è·ä½ä¸‹
```

```
[ç¾çŠ¶ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ]
## ç·åˆè©•ä¾¡

{% if summary %}
### ç·åˆæ‰€è¦‹

{{ summary.summary if summary.summary else "è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚" }}

{% if summary.key_strengths %}
**âœ… å„ªã‚Œã¦ã„ã‚‹ç‚¹:**
{% for strength in summary.key_strengths %}
- {{ strength }}
{% endfor %}
{% endif %}
```

**å·®ç•°:**
- âŒ â˜…è©•ä¾¡ãŒæ¬ è½
- âŒ è©•ä¾¡ã‚¹ã‚³ã‚¢(X.X/5.0)ãŒæ¬ è½
- âœ… å„ªã‚Œã¦ã„ã‚‹ç‚¹/æ”¹å–„ç‚¹ã®æ§‹é€ ã¯ä¸€è‡´

**æ”¹å–„ãƒã‚¤ãƒ³ãƒˆ (ã‚µãƒ³ãƒ—ãƒ« vs ç¾çŠ¶):**
```
[ã‚µãƒ³ãƒ—ãƒ«]
## ğŸ’¡ æ”¹å–„ãƒã‚¤ãƒ³ãƒˆ

ä»Šå›ã®ãƒ™ãƒ¼ã‚¹èµ°ï¼ˆæœ‰é…¸ç´ ã‚¾ãƒ¼ãƒ³ä¸­å¿ƒï¼‰ã‚’æ¬¡å›å®Ÿæ–½ã™ã‚‹éš›ã®æ”¹å–„ç‚¹ï¼š

### 1. ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—ã®å°å…¥ â­ é‡è¦åº¦: é«˜
**ç¾çŠ¶**: ãªã—ï¼ˆæœ€åˆã‹ã‚‰å¿ƒæ‹145bpmã§ã‚¹ã‚¿ãƒ¼ãƒˆï¼‰

**æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:**
- æœ€åˆã®1-1.5kmã‚’ã‚†ã£ãã‚Šé–‹å§‹ï¼ˆ7:30-8:00/kmï¼‰
- å¿ƒæ‹120-135bpmã€ãƒ‘ãƒ¯ãƒ¼180-200Wã‚’ç›®å®‰ã«

**æœŸå¾…åŠ¹æœ**: æ€ªæˆ‘ãƒªã‚¹ã‚¯ä½æ¸›ã€ãƒ¡ã‚¤ãƒ³èµ°è¡Œã§ã®åŠ¹ç‡å‘ä¸Š
```

```
[ç¾çŠ¶ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ]
## ğŸ’¡ æ”¹å–„ãƒã‚¤ãƒ³ãƒˆ

{% if summary and summary.recommendations %}
{{ summary.recommendations }}
{% else %}
æ”¹å–„ãƒã‚¤ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚
{% endif %}
```

**å·®ç•°:**
- âŒ æ§‹é€ åŒ–ã•ã‚Œã¦ã„ãªã„ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã®ã¿ï¼‰
- âŒ â­é‡è¦åº¦è¡¨ç¤ºãªã—
- âŒ ç¾çŠ¶/æ¨å¥¨/æœŸå¾…åŠ¹æœã®3æ®µéšæ§‹æˆãªã—

#### 4. ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã®å·®ç•°

**ãƒ•ã‚©ãƒ¼ãƒ åŠ¹ç‡è¡¨ (ã‚µãƒ³ãƒ—ãƒ« vs æœŸå¾…ã•ã‚Œã‚‹è¡¨ç¤º):**
```
[ã‚µãƒ³ãƒ—ãƒ« - éå¸¸ã«è©³ç´°]
| æŒ‡æ¨™ | å®Ÿæ¸¬å€¤ | ãƒšãƒ¼ã‚¹åŸºæº–å€¤ | è£œæ­£ã‚¹ã‚³ã‚¢ | è©•ä¾¡ |
|------|--------|------------|-----------|------|
| **æ¥åœ°æ™‚é–“** | 253.0ms | 266.3ms | **-5.0%** å„ªç§€ | â˜…â˜…â˜…â˜…â˜… 5.0 |
| **å‚ç›´æŒ¯å¹…** | 7.13cm | 7.46cm | **-4.4%** å„ªç§€ | â˜…â˜…â˜…â˜…â˜† 4.5 |
| **å‚ç›´æ¯”ç‡** | 8.89% | 8.0-9.5% | ç†æƒ³ç¯„å›²å†… | â˜…â˜…â˜…â˜…â˜… 5.0 |
```

**ç¾çŠ¶ã®å®Ÿè£…çŠ¶æ³:**
- âœ… ãƒšãƒ¼ã‚¹åŸºæº–å€¤è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã¯å®Ÿè£…æ¸ˆã¿ï¼ˆ`_calculate_pace_corrected_form_efficiency`ï¼‰
- âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã®è¡¨ç¤ºãŒç°¡æ˜“åŒ–ã•ã‚Œã¦ã„ã‚‹
- âŒ â˜…è©•ä¾¡è¡¨ç¤ºãŒæ¬ è½

**ã‚¹ãƒ—ãƒªãƒƒãƒˆè¡¨ (Intervalæ™‚ã®ã‚¿ã‚¤ãƒ—åˆ—):**
```
[ã‚µãƒ³ãƒ—ãƒ«]
| Split | ã‚¿ã‚¤ãƒ— | è·é›¢ | ãƒšãƒ¼ã‚¹ | å¿ƒæ‹ | ... |
|-------|-------|------|--------|------|-----|
| 1 | W-up | 1.00km | 7:00 | 135 | ... |
| 3 | **W1** | 1.00km | **4:28** | **170** | ... |
| 4 | R1 | 0.40km | 6:30 | 145 | ... |
```

**ç¾çŠ¶:**
- âœ… `intensity_type` åˆ—ã¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§æ¡ä»¶ä»˜ãè¡¨ç¤º
- âœ… DuckDB splits table ã« `intensity_type` å­˜åœ¨
- âš ï¸ ã‚¿ã‚¤ãƒ—è¡¨ç¤ºãŒ "W-up/W1/R1" å½¢å¼ã§ã¯ãªã "warmup/active/rest"

#### 5. Agentå‡ºåŠ›å½¢å¼ã®å·®ç•°

**summary-section-analyst ã®å‡ºåŠ›:**
```python
# ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒãƒ¼ãƒˆã§æœŸå¾…ã•ã‚Œã‚‹å½¢å¼
{
    "summary": "ä»Šæ—¥ã®ãƒ©ãƒ³ã¯è³ªã®é«˜ã„...",  # â˜…è©•ä¾¡å«ã‚€
    "key_strengths": ["...", "..."],         # ç®‡æ¡æ›¸ããƒªã‚¹ãƒˆ
    "improvement_areas": ["...", "..."],     # ç®‡æ¡æ›¸ããƒªã‚¹ãƒˆ
    "recommendations": """
### 1. ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—ã®å°å…¥ â­ é‡è¦åº¦: é«˜
**ç¾çŠ¶**: ãªã—
**æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:**
- æœ€åˆã®1-1.5kmã‚’ã‚†ã£ãã‚Šé–‹å§‹
**æœŸå¾…åŠ¹æœ**: æ€ªæˆ‘ãƒªã‚¹ã‚¯ä½æ¸›
"""
}
```

**ç¾çŠ¶ã®å®Ÿè£…:**
- âœ… `summary`, `key_strengths`, `improvement_areas` ã¯å®Ÿè£…æ¸ˆã¿
- âŒ `summary` ã«â˜…è©•ä¾¡ãŒå«ã¾ã‚Œã¦ã„ãªã„
- âŒ `recommendations` ãŒæ§‹é€ åŒ–ã•ã‚Œã¦ã„ãªã„ï¼ˆãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³å½¢å¼ã§ãªã„ï¼‰

## è¨­è¨ˆ

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

#### 1. Training Type Detection & Category Mapping

**ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼:**
```
DuckDB (hr_efficiency.training_type)
    â†“
ReportGeneratorWorker.load_performance_data()
    â†“ training_type string
ReportTemplateRenderer.render_report()
    â†“ training_type_category
Jinja2 Template
    â†“ ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤ºåˆ¶å¾¡
Final Report
```

**Training Type Categorization:**
```python
def get_training_type_category(training_type: str) -> str:
    """
    Map training_type to template category.

    Returns:
        - "low_moderate": recovery, aerobic_base, aerobic_endurance
        - "tempo_threshold": tempo, lactate_threshold
        - "interval_sprint": vo2max, anaerobic_capacity, speed
    """
    interval_sprint = {"vo2max", "anaerobic_capacity", "speed"}
    tempo_threshold = {"tempo", "lactate_threshold"}

    if training_type in interval_sprint:
        return "interval_sprint"
    elif training_type in tempo_threshold:
        return "tempo_threshold"
    else:
        return "low_moderate"
```

**ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå†…ã§ã®ä½¿ç”¨:**
```jinja2
{% set training_type_category = training_type_category|default("low_moderate") %}
{% set show_physiological = training_type_category in ["tempo_threshold", "interval_sprint"] %}
{% set is_interval = training_type_category == "interval_sprint" %}
```

#### 2. Star Rating System

**å®Ÿè£…ç®‡æ‰€:**
- **summary-section-analyst**: ç·åˆæ‰€è¦‹ã«â˜…è©•ä¾¡ã‚’å«ã‚ã‚‹
- **phase-section-analyst**: å„ãƒ•ã‚§ãƒ¼ã‚ºè©•ä¾¡ã«â˜…è©•ä¾¡ã‚’å«ã‚ã‚‹
- **efficiency-section-analyst**: ãƒ•ã‚©ãƒ¼ãƒ åŠ¹ç‡ã«â˜…è©•ä¾¡ã‚’å«ã‚ã‚‹
- **environment-section-analyst**: ç’°å¢ƒã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã«â˜…è©•ä¾¡ã‚’å«ã‚ã‚‹

**å‡ºåŠ›å½¢å¼:**
```python
# Agent output example
{
    "summary": "...(â˜…â˜…â˜…â˜…â˜† 4.2/5.0)",
    "rating": 4.2  # Optional: for template extraction
}
```

**ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‡¦ç†:**
```jinja2
{# Extract rating from summary text #}
{% set rating_match = summary.summary | regex_search(r'\(â˜…+â˜†* (\d+\.\d+)/5\.0\)') %}
{% if rating_match %}
### ç·åˆæ‰€è¦‹ ({{ rating_match.group(0) }})
{% else %}
### ç·åˆæ‰€è¦‹
{% endif %}
```

#### 3. Comparison Pace Selection Logic

**ç¾åœ¨ã®å®Ÿè£… (`_get_comparison_pace`):**
```python
def _get_comparison_pace(self, performance_data: dict) -> tuple[float, str]:
    training_type = performance_data.get("training_type", "unknown")
    structured_types = {"tempo", "lactate_threshold", "vo2max", "anaerobic_capacity", "speed"}

    if training_type in structured_types:
        run_metrics = performance_data.get("run_metrics")
        if run_metrics and run_metrics.get("avg_pace_seconds_per_km"):
            return (run_metrics["avg_pace_seconds_per_km"], "main_set")

    return (performance_data["basic_metrics"]["avg_pace_seconds_per_km"], "overall")
```

**ã‚µãƒ³ãƒ—ãƒ«æ¤œè¨¼:**
- âœ… Base run: å…¨ä½“ãƒšãƒ¼ã‚¹ä½¿ç”¨ï¼ˆæ­£ã—ã„ï¼‰
- âœ… Interval: WorkåŒºé–“ãƒšãƒ¼ã‚¹ä½¿ç”¨ï¼ˆæ­£ã—ã„ï¼‰
- âœ… Threshold: ãƒ¡ã‚¤ãƒ³åŒºé–“ãƒšãƒ¼ã‚¹ä½¿ç”¨ï¼ˆæ­£ã—ã„ï¼‰

**å•é¡Œç‚¹:**
- âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ `pace_source` è¡¨ç¤ºãŒãªã„
- âŒ "ãƒ¡ã‚¤ãƒ³ã‚»ãƒƒãƒˆãƒšãƒ¼ã‚¹æ¯”è¼ƒ" ã¨ã„ã†æ³¨é‡ˆãŒãªã„

#### 4. Physiological Indicators Display

**è¡¨ç¤ºæ¡ä»¶:**
```jinja2
{% if show_physiological and vo2_max_data and lactate_threshold_data %}
### ç”Ÿç†å­¦çš„æŒ‡æ¨™ã‚µãƒãƒªãƒ¼

| æŒ‡æ¨™ | ç¾åœ¨å€¤ | è©•ä¾¡ |
|------|--------|------|
| **VO2 Max** | {{ vo2_max_data.precise_value }} ml/kg/min | ... |
| **VO2 Maxåˆ©ç”¨ç‡** | {{ vo2_max_utilization }}% | ... |
| **é–¾å€¤ãƒšãƒ¼ã‚¹** | {{ threshold_pace_formatted }}/km | ... |
| **FTP(ãƒ‘ãƒ¯ãƒ¼)** | {{ lactate_threshold_data.functional_threshold_power }} W | ... |
{% endif %}
```

**å¿…è¦ãªè¨ˆç®—:**
```python
# In ReportGeneratorWorker.generate_report()
if training_type_category in ["tempo_threshold", "interval_sprint"]:
    # Calculate VO2 Max utilization
    vo2_max_pace = estimate_vo2_max_pace(vo2_max_data["precise_value"])
    target_pace = run_metrics["avg_pace_seconds_per_km"]
    vo2_max_utilization = (vo2_max_pace / target_pace) * 100

    # FTP percentage
    ftp = lactate_threshold_data["functional_threshold_power"]
    work_avg_power = run_metrics.get("avg_power", 0)
    ftp_percentage = (work_avg_power / ftp) * 100 if ftp > 0 else 0
```

#### 5. Structured Recommendations Format

**Agentå‡ºåŠ›è¦ä»¶ (summary-section-analyst):**
```python
{
    "recommendations": """
ä»Šå›ã®ãƒ™ãƒ¼ã‚¹èµ°ï¼ˆæœ‰é…¸ç´ ã‚¾ãƒ¼ãƒ³ä¸­å¿ƒï¼‰ã‚’æ¬¡å›å®Ÿæ–½ã™ã‚‹éš›ã®æ”¹å–„ç‚¹ï¼š

### 1. ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—ã®å°å…¥ â­ é‡è¦åº¦: é«˜
**ç¾çŠ¶**: ãªã—ï¼ˆæœ€åˆã‹ã‚‰å¿ƒæ‹145bpmã§ã‚¹ã‚¿ãƒ¼ãƒˆï¼‰

**æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:**
- æœ€åˆã®1-1.5kmã‚’ã‚†ã£ãã‚Šé–‹å§‹ï¼ˆ7:30-8:00/kmï¼‰
- å¿ƒæ‹120-135bpmã€ãƒ‘ãƒ¯ãƒ¼180-200Wã‚’ç›®å®‰ã«
- ç­‹è‚‰ãƒ»è…±ã®æº–å‚™ã€ç‰¹ã«é«˜æ¹¿åº¦ç’°å¢ƒã§ã¯ç™ºæ±—æ©Ÿèƒ½ã®æº–å‚™ã‚‚é‡è¦

**æœŸå¾…åŠ¹æœ**: æ€ªæˆ‘ãƒªã‚¹ã‚¯ä½æ¸›ã€ãƒ¡ã‚¤ãƒ³èµ°è¡Œã§ã®åŠ¹ç‡å‘ä¸Š

---

### 2. ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã®è¿½åŠ  â­ é‡è¦åº¦: é«˜
**ç¾çŠ¶**: ãªã—ï¼ˆå¿ƒæ‹151bpmã‹ã‚‰æ€¥åœæ­¢ï¼‰
...
"""
}
```

**æ§‹é€ åŒ–ãƒ«ãƒ¼ãƒ«:**
1. è¦‹å‡ºã—ã«ç•ªå·ã¨â­é‡è¦åº¦ã‚’å«ã‚ã‚‹
2. å„æ”¹å–„ç‚¹ã‚’ `---` ã§åŒºåˆ‡ã‚‹
3. å¿…é ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³: **ç¾çŠ¶**, **æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**, **æœŸå¾…åŠ¹æœ**

### ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«è¨­è¨ˆ

#### 1. Agent Output Schema Updates

**summary-section-analyst:**
```python
{
    "summary": str,              # â˜…è©•ä¾¡å«ã‚€
    "key_strengths": list[str],  # ç®‡æ¡æ›¸ã
    "improvement_areas": list[str],
    "recommendations": str       # æ§‹é€ åŒ–ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³
}
```

**phase-section-analyst:**
```python
{
    "warmup_evaluation": str,    # â˜…è©•ä¾¡å«ã‚€
    "run_evaluation": str,       # â˜…è©•ä¾¡å«ã‚€ (or main_evaluation)
    "recovery_evaluation": str,  # â˜…è©•ä¾¡å«ã‚€ (interval only)
    "cooldown_evaluation": str   # â˜…è©•ä¾¡å«ã‚€ (or finish_evaluation)
}
```

**efficiency-section-analyst:**
```python
{
    "efficiency": str,           # â˜…è©•ä¾¡å«ã‚€
    "pace_corrected_table": str  # è¡¨å½¢å¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
}
```

**environment-section-analyst:**
```python
{
    "environmental": str         # â˜…è©•ä¾¡å«ã‚€
}
```

#### 2. Template Context Enhancements

**æ–°è¦è¿½åŠ é …ç›®:**
```python
context = {
    # ... existing ...

    # Training type category
    "training_type_category": str,  # "low_moderate" | "tempo_threshold" | "interval_sprint"

    # Physiological indicators (tempo/interval only)
    "vo2_max_utilization": float,
    "vo2_max_utilization_eval": str,
    "threshold_pace_formatted": str,
    "threshold_pace_comparison": str,
    "ftp_percentage": float,
    "work_avg_power": float,

    # Star ratings extracted from agent text
    "summary_rating_stars": str,    # "â˜…â˜…â˜…â˜…â˜†"
    "summary_rating_score": float,  # 4.2
    "warmup_rating_stars": str,
    "warmup_rating_score": float,
    "main_rating_stars": str,
    "main_rating_score": float,
    "recovery_rating_stars": str,
    "recovery_rating_score": float,
    "cooldown_rating_stars": str,
    "cooldown_rating_score": float,
    "form_efficiency_rating_stars": str,
    "form_efficiency_rating_score": float,
    "environment_rating_stars": str,
    "environment_rating_score": float,

    # Interval-specific
    "interval_graph_analysis": str,  # Mermaidã‚°ãƒ©ãƒ•ä¸‹ã®åˆ†ææ–‡
    "target_segments_description": str,  # "Workã‚»ã‚°ãƒ¡ãƒ³ãƒˆ5æœ¬ã®ã¿"
}
```

### API/ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¨­è¨ˆ

#### 1. ReportGeneratorWorker Enhancements

**æ–°è¦ãƒ¡ã‚½ãƒƒãƒ‰:**
```python
def _get_training_type_category(self, training_type: str) -> str:
    """Map training_type to template category."""
    pass

def _calculate_physiological_indicators(
    self,
    training_type_category: str,
    vo2_max_data: dict,
    lactate_threshold_data: dict,
    run_metrics: dict
) -> dict:
    """Calculate VO2 Max utilization, FTP%, etc."""
    pass

def _extract_star_rating(self, text: str) -> tuple[str, float] | None:
    """Extract star rating from agent text using regex."""
    # Pattern: (â˜…â˜…â˜…â˜…â˜† 4.2/5.0)
    pass

def _generate_interval_graph_analysis(
    self,
    splits: list[dict],
    run_metrics: dict,
    recovery_metrics: dict
) -> str:
    """Generate Work/Recovery analysis text for interval reports."""
    pass
```

#### 2. Agent Prompt Updates

**summary-section-analyst.md:**
```markdown
## å‡ºåŠ›å½¢å¼

**section_type**: `"summary"`

### ç·åˆæ‰€è¦‹ã«â˜…è©•ä¾¡ã‚’å«ã‚ã‚‹ã“ã¨

å¿…ãšä»¥ä¸‹ã®å½¢å¼ã§â˜…è©•ä¾¡ã‚’å«ã‚ã‚‹:

```python
{
    "summary": """
ä»Šæ—¥ã®ãƒ©ãƒ³ã¯è³ªã®é«˜ã„æœ‰é…¸ç´ ãƒ™ãƒ¼ã‚¹èµ°ã§ã—ãŸã€‚...(â˜…â˜…â˜…â˜…â˜† 4.2/5.0)
""",
    "key_strengths": [...],
    "improvement_areas": [...],
    "recommendations": """
### 1. ã‚¿ã‚¤ãƒˆãƒ« â­ é‡è¦åº¦: é«˜
**ç¾çŠ¶**: ...
**æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:**
- ...
**æœŸå¾…åŠ¹æœ**: ...
---
### 2. ã‚¿ã‚¤ãƒˆãƒ« â­ é‡è¦åº¦: ä¸­
...
"""
}
```

### è©•ä¾¡åŸºæº–
- 5.0: å®Œç’§ï¼ˆå…¨æŒ‡æ¨™å„ªç§€ã€æ”¹å–„ç‚¹ãªã—ï¼‰
- 4.5-4.9: éå¸¸ã«è‰¯å¥½ï¼ˆä¸€éƒ¨è»½å¾®ãªæ”¹å–„ç‚¹ï¼‰
- 4.0-4.4: è‰¯å¥½ï¼ˆæ˜ç¢ºãªå¼·ã¿ã‚ã‚Šã€æ”¹å–„ä½™åœ°ã‚ã‚Šï¼‰
- 3.5-3.9: æ¨™æº–çš„ï¼ˆå¼·ã¿ã¨èª²é¡ŒãŒæ··åœ¨ï¼‰
- 3.0-3.4: è¦æ”¹å–„ï¼ˆèª²é¡ŒãŒç›®ç«‹ã¤ï¼‰
```

**phase-section-analyst.md:**
```markdown
## å‡ºåŠ›å½¢å¼

å„ãƒ•ã‚§ãƒ¼ã‚ºè©•ä¾¡ã«â˜…è©•ä¾¡ã‚’å«ã‚ã‚‹ã“ã¨:

```python
{
    "warmup_evaluation": """
**å®Ÿéš›**: 2km @ 7:00â†’6:50/kmã€å¿ƒæ‹135â†’142bpm

**è©•ä¾¡**: æ®µéšçš„ã«ãƒšãƒ¼ã‚¹ãƒ»å¿ƒæ‹ã‚’ä¸Šæ˜‡ã•ã›ã€ç†æƒ³çš„ãªæº–å‚™ãŒã§ãã¦ã„ã¾ã™ã€‚(â˜…â˜…â˜…â˜…â˜… 5.0/5.0)

**æ”¹å–„ç‚¹**: ãªã—
""",
    "run_evaluation": "...(â˜…â˜…â˜…â˜…â˜† 4.8/5.0)",
    "cooldown_evaluation": "...(â˜…â˜…â˜…â˜†â˜† 3.5/5.0)"
}
```
```

#### 3. Template Filter/Function Additions

**æ–°è¦Jinja2ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼:**
```python
@app.template_filter('extract_star_rating')
def extract_star_rating(text: str) -> dict:
    """
    Extract star rating from text.

    Returns:
        {"stars": "â˜…â˜…â˜…â˜…â˜†", "score": 4.2, "text_without_rating": "..."}
    """
    import re
    pattern = r'\(([â˜…â˜†]+) (\d+\.\d+)/5\.0\)'
    match = re.search(pattern, text)
    if match:
        return {
            "stars": match.group(1),
            "score": float(match.group(2)),
            "text_without_rating": re.sub(pattern, "", text).strip()
        }
    return {"stars": "", "score": 0.0, "text_without_rating": text}

@app.template_filter('format_intensity_type')
def format_intensity_type(intensity_type: str, index: int) -> str:
    """
    Format intensity_type for interval display.

    Args:
        intensity_type: "warmup" | "active" | "rest" | "cooldown"
        index: Split index

    Returns:
        "W-up" | "W1" | "R1" | "C-down"
    """
    if intensity_type == "warmup":
        return "W-up"
    elif intensity_type == "cooldown":
        return "C-down"
    elif intensity_type == "active":
        # Count active splits up to this index
        work_count = count_active_splits_before(index)
        return f"W{work_count}"
    elif intensity_type == "rest":
        recovery_count = count_rest_splits_before(index)
        return f"R{recovery_count}"
    return intensity_type
```

## å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º

### Phase 1: Template Structure & Star Ratings (å„ªå…ˆåº¦: æœ€é«˜)

**ç›®çš„**: ã‚µãƒ³ãƒ—ãƒ«ã¨åŒã˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ§‹é€ ã‚’å®Ÿç¾ã—ã€â˜…è©•ä¾¡ã‚’å…¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¿½åŠ 

**ã‚¿ã‚¹ã‚¯:**
1. **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ§‹é€ ä¿®æ­£**
   - [ ] ç”Ÿç†å­¦çš„æŒ‡æ¨™ã‚µãƒãƒªãƒ¼ã®é…ç½®ç¢ºèªï¼ˆTempo/Interval onlyï¼‰
   - [ ] é¡ä¼¼ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆæ¯”è¼ƒã®æ³¨é‡ˆè¿½åŠ ï¼ˆpace_sourceè¡¨ç¤ºï¼‰
   - [ ] ç·åˆæ‰€è¦‹ã®â˜…è©•ä¾¡è¡¨ç¤º
   - [ ] ãƒ•ã‚§ãƒ¼ã‚ºè©•ä¾¡ã®â˜…è©•ä¾¡è¡¨ç¤ºï¼ˆå„ãƒ•ã‚§ãƒ¼ã‚ºï¼‰
   - [ ] ç’°å¢ƒã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã®â˜…è©•ä¾¡è¡¨ç¤º
   - [ ] ãƒ•ã‚©ãƒ¼ãƒ åŠ¹ç‡ã®â˜…è©•ä¾¡è¡¨ç¤º

2. **Agent Promptæ›´æ–° (summary-section-analyst)**
   - [ ] ç·åˆæ‰€è¦‹ã«â˜…è©•ä¾¡ã‚’å«ã‚ã‚‹æŒ‡ç¤ºè¿½åŠ 
   - [ ] è©•ä¾¡åŸºæº–æ˜ç¤ºï¼ˆ5æ®µéšï¼‰
   - [ ] recommendationsã®æ§‹é€ åŒ–ãƒ«ãƒ¼ãƒ«è¿½åŠ ï¼ˆâ­é‡è¦åº¦ï¼‰
   - [ ] æ”¹å–„ãƒã‚¤ãƒ³ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæä¾›

3. **Agent Promptæ›´æ–° (phase-section-analyst)**
   - [ ] å„ãƒ•ã‚§ãƒ¼ã‚ºè©•ä¾¡ã«â˜…è©•ä¾¡ã‚’å«ã‚ã‚‹æŒ‡ç¤ºè¿½åŠ 
   - [ ] Training typeåˆ¥è©•ä¾¡åŸºæº–ã®æ˜ç¢ºåŒ–
   - [ ] ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥è©•ä¾¡åŸºæº–ï¼ˆ5æ®µéšï¼‰

4. **Agent Promptæ›´æ–° (efficiency/environment)**
   - [ ] â˜…è©•ä¾¡ã‚’å«ã‚ã‚‹æŒ‡ç¤ºè¿½åŠ 
   - [ ] è©•ä¾¡åŸºæº–æ˜ç¤º

**ãƒ†ã‚¹ãƒˆ:**
- [ ] Base run: ç·åˆæ‰€è¦‹â˜…4.2ã€ãƒ•ã‚§ãƒ¼ã‚ºè©•ä¾¡â˜…è¡¨ç¤ºç¢ºèª
- [ ] Interval: ç·åˆæ‰€è¦‹â˜…4.8ã€Work/Recovery/Cooldownè©•ä¾¡ç¢ºèª
- [ ] Threshold: ç·åˆæ‰€è¦‹â˜…4.3ã€ãƒ¡ã‚¤ãƒ³åŒºé–“è©•ä¾¡é‡è¦–ç¢ºèª

**å—ã‘å…¥ã‚ŒåŸºæº–:**
- å…¨ãƒ¬ãƒãƒ¼ãƒˆã‚¿ã‚¤ãƒ—ã§â˜…è©•ä¾¡ãŒé©åˆ‡ã«è¡¨ç¤ºã•ã‚Œã‚‹
- æ”¹å–„ãƒã‚¤ãƒ³ãƒˆãŒæ§‹é€ åŒ–ã•ã‚Œã‚‹ï¼ˆâ­é‡è¦åº¦ä»˜ãï¼‰
- ã‚µãƒ³ãƒ—ãƒ«ã¨åŒã˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³é †åº

### Phase 2: Training Type-Specific Content (å„ªå…ˆåº¦: é«˜)

**ç›®çš„**: Training typeåˆ¥ã®å†…å®¹å·®ã‚’å®Ÿè£…

**ã‚¿ã‚¹ã‚¯:**
1. **Training Type Category Mapping**
   - [ ] `ReportGeneratorWorker._get_training_type_category()` å®Ÿè£…
   - [ ] ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ `training_type_category` å¤‰æ•°è¨­å®š
   - [ ] `show_physiological`, `is_interval` ãƒ•ãƒ©ã‚°è¨­å®š

2. **Physiological Indicators Calculation**
   - [ ] VO2 Max utilizationè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
   - [ ] FTP percentageè¨ˆç®—
   - [ ] Threshold pace comparison textç”Ÿæˆ
   - [ ] Work average power/HRè¨ˆç®—ï¼ˆInterval/Thresholdç”¨ï¼‰

3. **Comparison Pace Annotation**
   - [ ] ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ `pace_source` è¡¨ç¤º
   - [ ] "éå»ã®åŒæ¡ä»¶ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆï¼ˆ**ãƒ¡ã‚¤ãƒ³ã‚»ãƒƒãƒˆãƒšãƒ¼ã‚¹æ¯”è¼ƒ**ï¼‰" æ³¨é‡ˆ

4. **Interval-Specific Elements**
   - [ ] ã‚¹ãƒ—ãƒªãƒƒãƒˆè¡¨ã«ã‚¿ã‚¤ãƒ—åˆ—è¿½åŠ ï¼ˆW-up/W1/R1/C-downï¼‰
   - [ ] Mermaidã‚°ãƒ©ãƒ•åˆ†ææ–‡ç”Ÿæˆï¼ˆWork/Recoveryæ¨ç§»ï¼‰
   - [ ] è©•ä¾¡å¯¾è±¡æ˜ç¤ºãƒ†ã‚­ã‚¹ãƒˆï¼ˆ"Workã‚»ã‚°ãƒ¡ãƒ³ãƒˆ5æœ¬ã®ã¿"ï¼‰
   - [ ] 4ãƒ•ã‚§ãƒ¼ã‚ºè©•ä¾¡ï¼ˆwarmup/run/recovery/cooldownï¼‰

5. **Threshold-Specific Elements**
   - [ ] è©•ä¾¡å¯¾è±¡æ˜ç¤ºï¼ˆ"ãƒ¡ã‚¤ãƒ³åŒºé–“ã®ã¿è©•ä¾¡"ï¼‰
   - [ ] ãƒ•ã‚©ãƒ¼ãƒ åŠ¹ç‡ã‚’ãƒ¡ã‚¤ãƒ³åŒºé–“ã®ã¿è¨ˆç®—
   - [ ] Zone 4æ™‚é–“æ¯”ç‡ã®è¡¨ç¤ºãƒ»è©•ä¾¡

**ãƒ†ã‚¹ãƒˆ:**
- [ ] Base run: ç”Ÿç†å­¦çš„ã‚µãƒãƒªãƒ¼ãªã—ã€å…¨ä½“ãƒšãƒ¼ã‚¹æ¯”è¼ƒ
- [ ] Interval: ç”Ÿç†å­¦çš„ã‚µãƒãƒªãƒ¼ã‚ã‚Šã€WorkåŒºé–“æ¯”è¼ƒã€4ãƒ•ã‚§ãƒ¼ã‚ºè©•ä¾¡
- [ ] Threshold: ç”Ÿç†å­¦çš„ã‚µãƒãƒªãƒ¼ã‚ã‚Šã€ãƒ¡ã‚¤ãƒ³åŒºé–“æ¯”è¼ƒã€Zone 4è©•ä¾¡

**å—ã‘å…¥ã‚ŒåŸºæº–:**
- Training typeæ¤œå‡ºãŒæ­£ã—ãå‹•ä½œ
- å„typeã§é©åˆ‡ãªå†…å®¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- ä¸è¦ãªã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒéè¡¨ç¤ºã«ãªã‚‹

### Phase 3: Data Display Formatting (å„ªå…ˆåº¦: ä¸­)

**ç›®çš„**: è¡¨å½¢å¼ãƒ»ã‚°ãƒ©ãƒ•ãƒ»è©³ç´°è¡¨ç¤ºã‚’ã‚µãƒ³ãƒ—ãƒ«ã¨ä¸€è‡´ã•ã›ã‚‹

**ã‚¿ã‚¹ã‚¯:**
1. **ãƒ•ã‚©ãƒ¼ãƒ åŠ¹ç‡è¡¨ã®æ‹¡å¼µ**
   - [ ] ãƒšãƒ¼ã‚¹åŸºæº–å€¤åˆ—è¿½åŠ 
   - [ ] è£œæ­£ã‚¹ã‚³ã‚¢åˆ—è¿½åŠ ï¼ˆ-X.X%å½¢å¼ï¼‰
   - [ ] â˜…è©•ä¾¡åˆ—è¿½åŠ 
   - [ ] è¡¨ãƒ˜ãƒƒãƒ€ãƒ¼ã®çµ±ä¸€

2. **ã‚¹ãƒ—ãƒªãƒƒãƒˆè¡¨ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ”¹å–„**
   - [ ] ã‚¿ã‚¤ãƒ—åˆ—ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆW-up/W1/R1å½¢å¼ï¼‰
   - [ ] WorkåŒºé–“ã®**å¤ªå­—**å¼·èª¿
   - [ ] åˆ—å¹…ãƒ»é…ç½®ã®æœ€é©åŒ–

3. **Mermaidã‚°ãƒ©ãƒ•åˆ†æã®è¿½åŠ **
   - [ ] Interval: Work/Recoveryæ¨ç§»åˆ†æ
   - [ ] Threshold: ãƒ¡ã‚¤ãƒ³åŒºé–“ã®å®‰å®šæ€§åˆ†æ
   - [ ] Base: ãƒšãƒ¼ã‚¹ãƒ»å¿ƒæ‹æ¨ç§»ã®ç°¡æ½”ãªåˆ†æ

4. **æŠ˜ã‚ŠãŸãŸã¿è©³ç´°ã®å……å®Ÿ**
   - [ ] ã‚¹ãƒ—ãƒªãƒƒãƒˆè©³ç´°åˆ†æã®å¼·åŒ–
   - [ ] æŠ€è¡“çš„è©³ç´°ã®æ‹¡å……
   - [ ] ç”¨èªè§£èª¬ã®Training typeåˆ¥ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

**ãƒ†ã‚¹ãƒˆ:**
- [ ] ãƒ•ã‚©ãƒ¼ãƒ åŠ¹ç‡è¡¨ãŒã‚µãƒ³ãƒ—ãƒ«ã¨ä¸€è‡´
- [ ] ã‚¹ãƒ—ãƒªãƒƒãƒˆè¡¨ã®å¯èª­æ€§å‘ä¸Š
- [ ] ã‚°ãƒ©ãƒ•åˆ†æãŒæœ‰ç›Š

**å—ã‘å…¥ã‚ŒåŸºæº–:**
- è¡¨å½¢å¼ãŒã‚µãƒ³ãƒ—ãƒ«ã¨è¦–è¦šçš„ã«ä¸€è‡´
- ã‚°ãƒ©ãƒ•åˆ†æãŒçš„ç¢º
- æŠ˜ã‚ŠãŸãŸã¿è¦ç´ ãŒé©åˆ‡ã«æ©Ÿèƒ½

### Phase 4: Agent Output Quality Improvement (å„ªå…ˆåº¦: ä¸­)

**ç›®çš„**: Agentå‡ºåŠ›ã®è³ªã‚’å‘ä¸Šã•ã›ã€ã‚µãƒ³ãƒ—ãƒ«ã®æ–‡ç« å“è³ªã«è¿‘ã¥ã‘ã‚‹

**ã‚¿ã‚¹ã‚¯:**
1. **summary-section-analystå¼·åŒ–**
   - [ ] ç·åˆæ‰€è¦‹ã®æ–‡ç« æ§‹é€ æ”¹å–„ï¼ˆå°å…¥â†’è©³ç´°â†’ã¾ã¨ã‚ï¼‰
   - [ ] å„ªã‚Œã¦ã„ã‚‹ç‚¹ã®å…·ä½“æ€§å‘ä¸Šï¼ˆæ•°å€¤å¼•ç”¨ï¼‰
   - [ ] æ”¹å–„å¯èƒ½ãªç‚¹ã®å»ºè¨­çš„è¡¨ç¾
   - [ ] recommendationsæ§‹é€ åŒ–ã®å¾¹åº•

2. **phase-section-analystå¼·åŒ–**
   - [ ] Training typeåˆ¥è©•ä¾¡åŸºæº–ã®é©ç”¨å¾¹åº•
   - [ ] ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥ã®å…·ä½“çš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
   - [ ] æ¬¡å›ã¸ã®æ”¹å–„ææ¡ˆã®è¿½åŠ 

3. **split-section-analystå¼·åŒ–**
   - [ ] ãƒã‚¤ãƒ©ã‚¤ãƒˆã®é¸å®šåŸºæº–æ˜ç¢ºåŒ–
   - [ ] è©³ç´°åˆ†æã®æ·±åº¦å‘ä¸Š
   - [ ] åŒºé–“æ¯”è¼ƒã®æœ‰ç›Šæ€§å‘ä¸Š

4. **efficiency-section-analystå¼·åŒ–**
   - [ ] ãƒšãƒ¼ã‚¹è£œæ­£è©•ä¾¡ã®èª¬æ˜æ”¹å–„
   - [ ] Training typeåˆ¥ãƒ•ã‚©ãƒ¼ãƒ è©•ä¾¡åŸºæº–
   - [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒˆãƒ¬ãƒ³ãƒ‰ã®åˆ†æ

**ãƒ†ã‚¹ãƒˆ:**
- [ ] 3ã¤ã®ã‚µãƒ³ãƒ—ãƒ«ã‚¿ã‚¤ãƒ—ã§æ–‡ç« å“è³ªã‚’æ¯”è¼ƒ
- [ ] å…·ä½“æ€§ãƒ»æœ‰ç›Šæ€§ãƒ»èª­ã¿ã‚„ã™ã•ã®è©•ä¾¡

**å—ã‘å…¥ã‚ŒåŸºæº–:**
- Agentå‡ºåŠ›ãŒã‚µãƒ³ãƒ—ãƒ«ã¨åŒç­‰ã®å“è³ª
- ãƒ‡ãƒ¼ã‚¿ãƒ‰ãƒªãƒ–ãƒ³ãªåˆ†æ
- å»ºè¨­çš„ã§å®Ÿè¡Œå¯èƒ½ãªææ¡ˆ

### Phase 5: Edge Cases & Refinement (å„ªå…ˆåº¦: ä½)

**ç›®çš„**: ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹å¯¾å¿œã¨ç´°éƒ¨ã®èª¿æ•´

**ã‚¿ã‚¹ã‚¯:**
1. **ãƒ‡ãƒ¼ã‚¿æ¬ æå¯¾å¿œ**
   - [ ] VO2 Max/é–¾å€¤ãƒ‡ãƒ¼ã‚¿ãªã—æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
   - [ ] é¡ä¼¼ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆãªã—æ™‚ã®è¡¨ç¤º
   - [ ] ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ†ææ¬ è½æ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

2. **Training typeæœªçŸ¥æ™‚ã®å¯¾å¿œ**
   - [ ] ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ±ºå®š
   - [ ] è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º

3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**
   - [ ] ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®é«˜é€ŸåŒ–
   - [ ] ä¸è¦ãªãƒ‡ãƒ¼ã‚¿å–å¾—ã®å‰Šæ¸›

4. **æ—¥æœ¬èªæ–‡ç« ã®è‡ªç„¶ã•å‘ä¸Š**
   - [ ] ä½“è¨€æ­¢ã‚ã®å‰Šæ¸›
   - [ ] æ¥ç¶šè©ã®é©åˆ‡ãªä½¿ç”¨
   - [ ] æ•¬ä½“/å¸¸ä½“ã®çµ±ä¸€

**ãƒ†ã‚¹ãƒˆ:**
- [ ] ãƒ‡ãƒ¼ã‚¿æ¬ æã‚±ãƒ¼ã‚¹ã§ã‚¨ãƒ©ãƒ¼ãªã—
- [ ] æœªçŸ¥training typeã§é©åˆ‡ãªè¡¨ç¤º
- [ ] ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚é–“ãŒè¨±å®¹ç¯„å›²

**å—ã‘å…¥ã‚ŒåŸºæº–:**
- ã™ã¹ã¦ã®ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã§é©åˆ‡ãªè¡¨ç¤º
- ã‚¨ãƒ©ãƒ¼ãªããƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ£åŒ–ãªã—

## ãƒ†ã‚¹ãƒˆè¨ˆç”»

### Unit Tests

**å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«: `tools/reporting/report_generator_worker.py`**

1. **Training Type Category Mapping**
   ```python
   def test_get_training_type_category():
       worker = ReportGeneratorWorker()
       assert worker._get_training_type_category("aerobic_base") == "low_moderate"
       assert worker._get_training_type_category("lactate_threshold") == "tempo_threshold"
       assert worker._get_training_type_category("vo2max") == "interval_sprint"
       assert worker._get_training_type_category("unknown") == "low_moderate"
   ```

2. **Star Rating Extraction**
   ```python
   def test_extract_star_rating():
       worker = ReportGeneratorWorker()
       text = "ä»Šæ—¥ã®ãƒ©ãƒ³ã¯ç´ æ™´ã‚‰ã—ã„...(â˜…â˜…â˜…â˜…â˜† 4.2/5.0)"
       stars, score = worker._extract_star_rating(text)
       assert stars == "â˜…â˜…â˜…â˜…â˜†"
       assert score == 4.2
   ```

3. **Physiological Indicators Calculation**
   ```python
   def test_calculate_physiological_indicators():
       worker = ReportGeneratorWorker()
       result = worker._calculate_physiological_indicators(
           training_type_category="tempo_threshold",
           vo2_max_data={"precise_value": 52.3},
           lactate_threshold_data={"functional_threshold_power": 285},
           run_metrics={"avg_pace_seconds_per_km": 304, "avg_power": 342}
       )
       assert "vo2_max_utilization" in result
       assert "ftp_percentage" in result
       assert result["ftp_percentage"] == pytest.approx(120.0, rel=0.1)
   ```

**å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«: `tools/reporting/report_template_renderer.py`**

1. **Intensity Type Formatting**
   ```python
   def test_format_intensity_type():
       assert format_intensity_type("warmup", 1) == "W-up"
       assert format_intensity_type("active", 3) == "W1"  # assuming 1st active
       assert format_intensity_type("rest", 4) == "R1"
       assert format_intensity_type("cooldown", 12) == "C-down"
   ```

### Integration Tests

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹: 3ã¤ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆ**

1. **Base Run Test (Activity 20625808856)**
   ```python
   def test_base_run_report_generation():
       worker = ReportGeneratorWorker()
       result = worker.generate_report(20625808856, "2025-10-08")

       report_content = Path(result["report_path"]).read_text()

       # Structure checks
       assert "## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚µãƒãƒªãƒ¼" in report_content
       assert "### é¡ä¼¼ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆã¨ã®æ¯”è¼ƒ" in report_content
       assert "ç”Ÿç†å­¦çš„æŒ‡æ¨™ã‚µãƒãƒªãƒ¼" not in report_content  # Should NOT appear

       # Star rating checks
       assert re.search(r'### ç·åˆæ‰€è¦‹ \(â˜…+â˜†* \d+\.\d+/5\.0\)', report_content)
       assert re.search(r'### ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—ãƒ•ã‚§ãƒ¼ã‚º \(â˜…+â˜†* \d+\.\d+/5\.0\)', report_content)

       # Content checks
       assert "éå»ã®åŒæ¡ä»¶ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆ" in report_content
       assert "å…¨ä½“ãƒšãƒ¼ã‚¹" in report_content or "overall" in report_content
   ```

2. **Interval Test**
   ```python
   def test_interval_report_generation():
       # Assume we have interval data in test DB
       worker = ReportGeneratorWorker()
       result = worker.generate_report(test_interval_activity_id, test_date)

       report_content = Path(result["report_path"]).read_text()

       # Structure checks
       assert "### ç”Ÿç†å­¦çš„æŒ‡æ¨™ã‚µãƒãƒªãƒ¼" in report_content
       assert "VO2 Maxåˆ©ç”¨ç‡" in report_content
       assert "FTP(ãƒ‘ãƒ¯ãƒ¼)" in report_content

       # Interval-specific checks
       assert "Work" in report_content
       assert "Recovery" in report_content
       assert "W1" in report_content or "W-up" in report_content

       # Phase evaluation (4 phases)
       assert "### Workãƒ•ã‚§ãƒ¼ã‚º" in report_content
       assert "### Recoveryãƒ•ã‚§ãƒ¼ã‚º" in report_content
   ```

3. **Threshold Test**
   ```python
   def test_threshold_report_generation():
       worker = ReportGeneratorWorker()
       result = worker.generate_report(20783281578, "2025-10-24")

       report_content = Path(result["report_path"]).read_text()

       # Structure checks
       assert "### ç”Ÿç†å­¦çš„æŒ‡æ¨™ã‚µãƒãƒªãƒ¼" in report_content
       assert "é–¾å€¤ãƒšãƒ¼ã‚¹" in report_content

       # Threshold-specific checks
       assert "ãƒ¡ã‚¤ãƒ³åŒºé–“" in report_content
       assert "Zone 4" in report_content

       # Comparison annotation
       assert "ãƒ¡ã‚¤ãƒ³ã‚»ãƒƒãƒˆãƒšãƒ¼ã‚¹æ¯”è¼ƒ" in report_content
   ```

### Performance Tests

1. **Report Generation Time**
   ```python
   def test_report_generation_performance():
       worker = ReportGeneratorWorker()
       start = time.time()
       worker.generate_report(20625808856, "2025-10-08")
       duration = time.time() - start

       assert duration < 5.0  # Should complete within 5 seconds
   ```

2. **Template Rendering Time**
   ```python
   def test_template_rendering_performance():
       renderer = ReportTemplateRenderer()
       context = load_test_context()

       start = time.time()
       renderer.render_report(**context)
       duration = time.time() - start

       assert duration < 1.0  # Template rendering should be fast
   ```

### Acceptance Tests

**æ¯”è¼ƒãƒ†ã‚¹ãƒˆ: ã‚µãƒ³ãƒ—ãƒ« vs ç”Ÿæˆãƒ¬ãƒãƒ¼ãƒˆ**

```python
def test_sample_reproduction_similarity():
    """
    ç”Ÿæˆãƒ¬ãƒãƒ¼ãƒˆãŒã‚µãƒ³ãƒ—ãƒ«ã¨ã©ã®ç¨‹åº¦ä¸€è‡´ã™ã‚‹ã‹ã‚’æ¤œè¨¼
    """
    worker = ReportGeneratorWorker()

    # Base run
    result = worker.generate_report(20625808856, "2025-10-08")
    generated = Path(result["report_path"]).read_text()
    sample = Path("result/individual/2025/10/2025-10-08_20625808856_SAMPLE_BALANCED.md").read_text()

    # Structure similarity
    assert count_sections(generated) == count_sections(sample)

    # Star rating presence
    assert count_star_ratings(generated) >= count_star_ratings(sample) * 0.8

    # Key phrases
    assert "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚µãƒãƒªãƒ¼" in generated
    assert "é¡ä¼¼ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆã¨ã®æ¯”è¼ƒ" in generated
    assert "æ”¹å–„ãƒã‚¤ãƒ³ãƒˆ" in generated

    # Training type-specific
    assert ("ç”Ÿç†å­¦çš„æŒ‡æ¨™ã‚µãƒãƒªãƒ¼" in generated) == ("ç”Ÿç†å­¦çš„æŒ‡æ¨™ã‚µãƒãƒªãƒ¼" in sample)
```

## ãƒªã‚¹ã‚¯è©•ä¾¡

### ãƒªã‚¹ã‚¯1: Agentå‡ºåŠ›å½¢å¼ã®å¤‰æ›´ã«ã‚ˆã‚‹å¾Œæ–¹äº’æ›æ€§å–ªå¤±

**é‡å¤§åº¦**: é«˜

**å½±éŸ¿ç¯„å›²:**
- æ—¢å­˜ã®section_analyses dataã«â˜…è©•ä¾¡ãŒå«ã¾ã‚Œã¦ã„ãªã„
- recommendationsæ§‹é€ ãŒæ—§å½¢å¼

**ç·©å’Œç­–:**
1. **æ®µéšçš„ç§»è¡Œ**
   - æ–°å½¢å¼ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨ã™ã‚‹ãŒã€æ—§å½¢å¼ã‚‚ã‚µãƒãƒ¼ãƒˆ
   - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ä¸¡å½¢å¼ã‚’å‡¦ç†å¯èƒ½ã«ã™ã‚‹

2. **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå´ã§ã®æŸ”è»Ÿãªå‡¦ç†**
   ```jinja2
   {# Extract star rating if present, else show plain text #}
   {% set rating = summary.summary | extract_star_rating %}
   {% if rating.score > 0 %}
   ### ç·åˆæ‰€è¦‹ ({{ rating.stars }} {{ rating.score }}/5.0)
   {{ rating.text_without_rating }}
   {% else %}
   ### ç·åˆæ‰€è¦‹
   {{ summary.summary }}
   {% endif %}
   ```

3. **æ®µéšçš„Agentæ›´æ–°**
   - Phase 1ã§ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¯¾å¿œ
   - Phase 4ã§Agent promptæ›´æ–°
   - å¤ã„ãƒ‡ãƒ¼ã‚¿ã§ã‚‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„

**å¯¾å¿œæœŸé™**: Phase 1å®Œäº†æ™‚

### ãƒªã‚¹ã‚¯2: Training Type Detectionå¤±æ•—

**é‡å¤§åº¦**: ä¸­

**å½±éŸ¿ç¯„å›²:**
- `hr_efficiency.training_type` ãŒ NULL ã¾ãŸã¯æœªçŸ¥ã®å€¤
- é©åˆ‡ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒé¸æŠã•ã‚Œãªã„

**ç·©å’Œç­–:**
1. **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯**
   ```python
   training_type = performance_data.get("training_type", "unknown")
   if not training_type or training_type == "unknown":
       # Heuristic detection based on pace variability
       if pace_consistency < 0.05:
           training_type_category = "low_moderate"
       elif has_recovery_phase:
           training_type_category = "interval_sprint"
       else:
           training_type_category = "low_moderate"
   ```

2. **è­¦å‘Šãƒ­ã‚°**
   - Training typeæœªæ¤œå‡ºæ™‚ã«ãƒ­ã‚°å‡ºåŠ›
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ‰‹å‹•ç¢ºèªã‚’ä¿ƒã™

3. **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**
   - ä¸æ˜æ™‚ã¯ `low_moderate` ã¨ã—ã¦æ‰±ã†
   - æœ€å°é™ã®æƒ…å ±ã‚’è¡¨ç¤º

**å¯¾å¿œæœŸé™**: Phase 2å®Ÿè£…æ™‚

### ãƒªã‚¹ã‚¯3: DuckDB Schemaå¤‰æ›´ã«ã‚ˆã‚‹äº’æ›æ€§å•é¡Œ

**é‡å¤§åº¦**: ä½

**å½±éŸ¿ç¯„å›²:**
- `performance_trends` ã®ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ï¼ˆrun/main, cooldown/finishï¼‰
- æ–°æ—§ãƒ‡ãƒ¼ã‚¿ã®æ··åœ¨

**ç·©å’Œç­–:**
1. **Schema Check Logic**
   - ç¾åœ¨ã®å®Ÿè£…ã¨åŒæ§˜ã€ã‚«ãƒ©ãƒ å­˜åœ¨ãƒã‚§ãƒƒã‚¯ã‚’ç¶™ç¶š
   ```python
   schema_check = conn.execute("PRAGMA table_info('performance_trends')").fetchall()
   column_names = [row[1] for row in schema_check]
   has_new_schema = "run_avg_pace_seconds_per_km" in column_names
   ```

2. **Legacy Support**
   - æ—§ã‚¹ã‚­ãƒ¼ãƒã§ã‚‚æ­£ã—ããƒãƒƒãƒ”ãƒ³ã‚°
   - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ä¸¡å‘½åè¦å‰‡ã‚’ã‚µãƒãƒ¼ãƒˆ

**å¯¾å¿œæœŸé™**: ç¶™ç¶šçš„ã«ç¶­æŒ

### ãƒªã‚¹ã‚¯4: Jinja2ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®è¤‡é›‘åŒ–

**é‡å¤§åº¦**: ä¸­

**å½±éŸ¿ç¯„å›²:**
- æ¡ä»¶åˆ†å²ã®å¢—åŠ ã«ã‚ˆã‚‹å¯èª­æ€§ä½ä¸‹
- ãƒ‡ãƒãƒƒã‚°å›°é›£
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ£åŒ–

**ç·©å’Œç­–:**
1. **ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã®æ´»ç”¨**
   - è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã¯Pythonå´ã§å®Ÿè£…
   - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ä¿ã¤

2. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**
   - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå†…ã«ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 
   - å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ç›®çš„ã‚’æ˜è¨˜

3. **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåˆ†å‰²**
   - å¿…è¦ã«å¿œã˜ã¦include/macroã‚’æ´»ç”¨
   ```jinja2
   {% include "sections/performance_summary.j2" %}
   {% include "sections/physiological_indicators.j2" %}
   ```

**å¯¾å¿œæœŸé™**: Phase 3å®Ÿè£…æ™‚ã«æ¤œè¨

### ãƒªã‚¹ã‚¯5: ã‚µãƒ³ãƒ—ãƒ«å†ç¾ã®å®Œå…¨æ€§æ¤œè¨¼å›°é›£

**é‡å¤§åº¦**: ä¸­

**å½±éŸ¿ç¯„å›²:**
- ã‚µãƒ³ãƒ—ãƒ«ã¨ã®å·®ç•°ã‚’å®šé‡è©•ä¾¡ã§ããªã„
- ä¸»è¦³çš„ãªåˆ¤æ–­ã«ä¾å­˜

**ç·©å’Œç­–:**
1. **æ§‹é€ æ¯”è¼ƒãƒ†ã‚¹ãƒˆ**
   - ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ•°ã€è¦‹å‡ºã—ã€è¡¨ã®åˆ—æ•°ã‚’æ¯”è¼ƒ
   - è‡ªå‹•ãƒ†ã‚¹ãƒˆã§æ¤œè¨¼

2. **æ‰‹å‹•ãƒ¬ãƒ“ãƒ¥ãƒ¼**
   - å„ã‚µãƒ³ãƒ—ãƒ«ã‚¿ã‚¤ãƒ—ã§ç”Ÿæˆãƒ¬ãƒãƒ¼ãƒˆã‚’ç›®è¦–ç¢ºèª
   - ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆä½œæˆ

3. **å·®åˆ†å¯è¦–åŒ–ãƒ„ãƒ¼ãƒ«**
   - Markdown diffãƒ„ãƒ¼ãƒ«ã§æ¯”è¼ƒ
   - æ§‹é€ ãƒ»å†…å®¹ã®å·®ç•°ã‚’å¯è¦–åŒ–

**å¯¾å¿œæœŸé™**: Phase 5ã§å®Ÿæ–½

## å—ã‘å…¥ã‚ŒåŸºæº–

### Phase 1å®Œäº†åŸºæº–
- [ ] å…¨ãƒ¬ãƒãƒ¼ãƒˆã‚¿ã‚¤ãƒ—ã§â˜…è©•ä¾¡ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆç·åˆæ‰€è¦‹ã€å…¨ãƒ•ã‚§ãƒ¼ã‚ºã€ãƒ•ã‚©ãƒ¼ãƒ ã€ç’°å¢ƒï¼‰
- [ ] æ”¹å–„ãƒã‚¤ãƒ³ãƒˆãŒæ§‹é€ åŒ–ã•ã‚Œã‚‹ï¼ˆâ­é‡è¦åº¦ã€ç¾çŠ¶/æ¨å¥¨/æœŸå¾…åŠ¹æœï¼‰
- [ ] ã‚»ã‚¯ã‚·ãƒ§ãƒ³é †åºãŒã‚µãƒ³ãƒ—ãƒ«ã¨ä¸€è‡´
- [ ] Unit testsã§star rating extractionæˆåŠŸ

### Phase 2å®Œäº†åŸºæº–
- [ ] Training type category mappingãŒæ­£ã—ãå‹•ä½œ
- [ ] Tempo/Intervalã§ç”Ÿç†å­¦çš„æŒ‡æ¨™ã‚µãƒãƒªãƒ¼è¡¨ç¤º
- [ ] Baseã§ç”Ÿç†å­¦çš„æŒ‡æ¨™ã‚µãƒãƒªãƒ¼éè¡¨ç¤º
- [ ] é¡ä¼¼ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆæ¯”è¼ƒã§pace_sourceæ³¨é‡ˆè¡¨ç¤º
- [ ] Intervalã§4ãƒ•ã‚§ãƒ¼ã‚ºè©•ä¾¡ã€Baseã§3ãƒ•ã‚§ãƒ¼ã‚ºè©•ä¾¡
- [ ] Integration testsã§3ã‚µãƒ³ãƒ—ãƒ«ã‚¿ã‚¤ãƒ—ã™ã¹ã¦æˆåŠŸ

### Phase 3å®Œäº†åŸºæº–
- [ ] ãƒ•ã‚©ãƒ¼ãƒ åŠ¹ç‡è¡¨ãŒã‚µãƒ³ãƒ—ãƒ«ã¨è¦–è¦šçš„ã«ä¸€è‡´ï¼ˆåŸºæº–å€¤ã€è£œæ­£ã‚¹ã‚³ã‚¢ã€â˜…è©•ä¾¡ï¼‰
- [ ] Intervalã‚¹ãƒ—ãƒªãƒƒãƒˆè¡¨ã§ã‚¿ã‚¤ãƒ—åˆ—ãŒæ­£ã—ãè¡¨ç¤ºï¼ˆW-up/W1/R1/C-downï¼‰
- [ ] Mermaidã‚°ãƒ©ãƒ•ä¸‹ã«åˆ†ææ–‡ãŒè¡¨ç¤ºï¼ˆInterval/Thresholdï¼‰
- [ ] æŠ˜ã‚ŠãŸãŸã¿è©³ç´°ãŒå……å®Ÿ

### Phase 4å®Œäº†åŸºæº–
- [ ] Agentå‡ºåŠ›ãŒã‚µãƒ³ãƒ—ãƒ«ã¨åŒç­‰ã®æ–‡ç« å“è³ªï¼ˆå…·ä½“æ€§ã€æœ‰ç›Šæ€§ï¼‰
- [ ] Training typeåˆ¥è©•ä¾¡åŸºæº–ãŒé©åˆ‡ã«é©ç”¨
- [ ] recommendationsæ§‹é€ åŒ–ãŒå¾¹åº•

### Phase 5å®Œäº†åŸºæº–
- [ ] ãƒ‡ãƒ¼ã‚¿æ¬ æã‚±ãƒ¼ã‚¹ã§ã‚¨ãƒ©ãƒ¼ãªãè¡¨ç¤º
- [ ] æœªçŸ¥training typeã§é©åˆ‡ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
- [ ] ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆæ™‚é–“ãŒ5ç§’ä»¥å†…
- [ ] å…¨Unit/Integration/Performance testsåˆæ ¼
- [ ] æ‰‹å‹•ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ã‚µãƒ³ãƒ—ãƒ«å†ç¾åº¦80%ä»¥ä¸Š

## æœ€çµ‚ç›®æ¨™

**3ã¤ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒãƒ¼ãƒˆã‚’åŸºæº–ã¨ã—ã¦ã€ä»¥ä¸‹ã‚’é”æˆ:**

1. **æ§‹é€ çš„ä¸€è²«æ€§**
   - ã‚»ã‚¯ã‚·ãƒ§ãƒ³é †åºãƒ»è¦‹å‡ºã—ãƒ»éšå±¤ãŒã‚µãƒ³ãƒ—ãƒ«ã¨ä¸€è‡´
   - Training typeåˆ¥ã«é©åˆ‡ãªå†…å®¹ã®è¡¨ç¤º/éè¡¨ç¤º

2. **å†…å®¹ã®å……å®Ÿåº¦**
   - â˜…è©•ä¾¡ãŒå…¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«å­˜åœ¨
   - ç”Ÿç†å­¦çš„æŒ‡æ¨™ã‚µãƒãƒªãƒ¼ï¼ˆTempo/Intervalã®ã¿ï¼‰
   - æ§‹é€ åŒ–ã•ã‚ŒãŸæ”¹å–„ãƒã‚¤ãƒ³ãƒˆï¼ˆâ­é‡è¦åº¦ä»˜ãï¼‰

3. **ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®çµ±ä¸€**
   - è¡¨å½¢å¼ã®è©³ç´°åº¦ãŒã‚µãƒ³ãƒ—ãƒ«ã¨ä¸€è‡´
   - Work/Recoveryã®æ˜ç¢ºãªè¡¨ç¤ºï¼ˆIntervalï¼‰
   - ãƒ¡ã‚¤ãƒ³åŒºé–“é‡è¦–ã®è©•ä¾¡ï¼ˆThresholdï¼‰

4. **æ–‡ç« å“è³ª**
   - ãƒ‡ãƒ¼ã‚¿ãƒ‰ãƒªãƒ–ãƒ³ã§å…·ä½“çš„
   - å»ºè¨­çš„ã§å®Ÿè¡Œå¯èƒ½ãªææ¡ˆ
   - è‡ªç„¶ãªæ—¥æœ¬èªè¡¨ç¾

**æˆåŠŸæŒ‡æ¨™:**
- ç”Ÿæˆãƒ¬ãƒãƒ¼ãƒˆã¨ã‚µãƒ³ãƒ—ãƒ«ã®æ§‹é€ ä¸€è‡´åº¦: 95%ä»¥ä¸Š
- â˜…è©•ä¾¡ã®å­˜åœ¨ç‡: 100%ï¼ˆå…¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
- æ‰‹å‹•ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ã®å“è³ªè©•ä¾¡: 4.0/5.0ä»¥ä¸Š
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯: "ã‚µãƒ³ãƒ—ãƒ«ã¨ã»ã¼åŒã˜" è©•ä¾¡

---

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:**
ã“ã®planning.mdã‚’main branchã«ã‚³ãƒŸãƒƒãƒˆå¾Œã€GitHub Issueã‚’ä½œæˆã—ã€`tdd-implementer` ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ãƒãƒ³ãƒ‰ã‚ªãƒ•ã—ã¦Phase 1ã‹ã‚‰å®Ÿè£…é–‹å§‹ã€‚
